%% s3859061
clear
clc
close all

m = 8; % mass
g = 9.81; %gravity 
H = 20; % drop height
tmax= 5; % total simulation time
t=[0:0.01:1]*tmax;
Cd = 0.5; %drag coefficient
alpha = 30; % incline angle

% Simulate segment AB to find the velocity io
xdotAB = @(t, x) ([x(2); -g-Cd*x(2)*sqrt(x(2)^2+x(4)^2)/m;...
    x(4); -Cd*x(4)*sqrt(x(2)^2+x(4)^2)/m]);

[tt,zz]=ode45(xdotAB,t,[H; 0; 0; 0]);

t_bounce= interp1(zz(:,1), tt, 0);
v_bounce = interp1(tt, zz(:,2), t_bounce);

u = v_bounce; 
z0 = 0;
h0 = 0;
v0z = abs(u)*cosd(alpha);
v0h = abs(u)*sind(alpha);


xdotBC = @(t, x) ([x(2); -g*cosd(alpha)-((Cd*x(2)*sqrt(x(2)^2+x(4)^2))/m); ...
    x(4); g*sind(alpha)-((Cd*x(4)*sqrt(x(2)^2+x(4)^2))/m)]);

[tt,zz]=ode45(xdotBC,t,[z0; v0z; h0; v0h]);

% ignore the first element because it indicates the first bounce
H = zz(2:end, 3); 
Z = zz(2:end, 1);

plot(H, Z,'LineWidth',3,'Color',[0 0.5 1]);
hold on;

plot(interp1(Z, H, 0), 0, 'ro', 'LineWidth', 2);
grid on; 
axis equal; 
xlabel('$h$ [m]','Interpreter','LaTeX'); 
ylabel('$z$ [m]','Interpreter','LaTeX');
title('\bf Projectile (With Air Drag)'); 
set(gca, 'FontSize',18); 

% print flip the values of z and h because we want to know the
% the position when z hits 0 again as it is the second bounce of the ball.
fprintf("Distance BC = %fm\n", interp1(Z, H, 0));